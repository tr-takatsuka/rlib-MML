# Music Macro Language Compiler

[ENGLISH](/README.md)

## Description

MML を 標準MIDIファイル へコンパイル(変換)するクラスライブラリです。C++17 での実装です。
- コマンドラインアプリとしてビルドできる形になっています。
- MML の文法は決まった規格があるわけではありませんが、暗黙の標準のようなものには沿うよう実装しています。

## Demo Page

https://rlib-mml.thinkridge.jp/

MML の作成から再生までをブラウザ上で行える形にまとめています。

## Requirement

C++17 環境でコンパイルできます。ビルドには boost が必要です。

以下の環境で動作確認しています。

- linux g++
- windows VisualStudio 2019,2022

# MML (Music Macro Language) 文法

## 音符 その他

|  表記  |  説明  |例|
| ---- | ---- | ---- |
|a～[+-][音長]| 音符(ノート)です。<br>直後に + - で半音上げ下げです(省略可)。<br>その後に音長を指定できます(省略可)。 | "f4" → 4分音符のファです。<br>"cdefgab" → ドレミファソラシです。音長はデフォルト値です。<br>"a-16." → 符点16分音符のラ♭です。
|r[音長]|  休符です。直後に音長を指定できます(省略可)。 | "r16" → 16分休符です。
|^[音長]|  タイです。直後に音長を指定できます(省略可)。<br>直前の音符の音長を足します。直前が音符ではない場合は休符と同じです。| "c4^4^4" → 4分音符３つ分の長さのドです。<br>"c4 t50 ^4 t20 ^4" → 4分音符３つ分の長さのドです。が、途中でテンポを変えています。音符と ^ の間に別命令を記述することが可です。
|l[音長]|  デフォルト音長です。<br>音符及び休符で音長指定を省略した場合に採用する値です| "l8 cde" → 8分音符のドレミです。
|<<br>> | オクターブアップ(<) ダウン(>) です。<br>1オクターブの範囲は ド(c)～シ(b) の12音です。| "c\<c>c\<c" → ド と １オクターブ上のド を２回繰り返します
|o[オクターブ値]| オクターブを指定します。値は -2～8 です<br>MIDIノートナンバー60はC3です。o3c と記述します| "o3 cde"  → MIDIノートナンバー60(C3)、62(D3)、64(E3) です。|
|t[テンポ値]| テンポを指定します。値は 1.0～999.0 を指定可です。少数も表記可です。| "t120 cde"  → テンポ120でドレミです|
|@[プログラムナンバー]| プログラムナンバー(音色)を指定します。値は0～127です。| "@3 cde"  → プログラムナンバー3でドレミです|
|v[ベロシティ値]| ベロシティ(ピアノでいうと鍵盤を叩く強さ)を指定します。値は0～127です。符号を付けると現在値からの相対指定になります。| "v123 cde v-10 fga"<br>→ ベロシティ123のドレミ、ベロシティ113のファソラですです|
|'[和音モード切り替え]| 音符では現在位置を進めないモードに切り替えます。現在位置を進めるには休符を使います。和音のような2音以上を同時に発音する場合に使います。| "l8 'cegr dfar'  "<br>→ 8分音符のドミソの和音と、レファラの和音です。|

### 音長
- 音の長さ(ここでは音長と表記します)の指定方法です。

| 表記  |  説明  |例|
| ---- | ---- | ---- |
|1～192<br>音符表記| 〇分音符の値を指定します。<br>12分音符や24分音符という表記も可です| "c4" → 4分音符のドです。|
|!1～!99999<br>ステップ数表記| ステップ数で指定します。4分音符が480です。| "c!240" → 8分音符のドです。|
|.<br>付点表記| 付点〇分音符というところの付点を意味します。<br>複数記述することで複付点音符の意味(直前の音長の半分を足す)になります。| "c4." → 付点4分音符のドです。<br>"c4..." → 4分音符と8分音符と16分音符と32分音符を足した音長のドです。|
|+ - 数値<br>音長の加減算指定|音長値を加減算します。|"c8+4" → 8分音符と4分音符を足した音長のドです。<br>"c32d32e1-32-32" → 32分音符のドレ、全音符から32分音符2つ分を短くしたミです。<br><br>"d-4" → この場合は、4分音符のレ♭です。ご注意下さい。|

## 関数

|  表記  |  説明  |例|
| ---- | ---- | ---- |
|CreatePort(<br>&emsp;name:[ポート名],<br>&emsp;channel:[チャンネル番号],<br>)| ポートを定義(宣言)します<br>チャンネル番号は 1～16 です。|"CreatePort(name:Piano, channel:3)" <br>→ "Piano"という名称でMIDIチャンネル3のポートを宣言し、切り替えます。|
|Port([ポート名])| ポート切り替えです|"Port(Piano) cde"  → ポート"Piano" で ドレミです|
|V([音量値])<br>別名 Volume| 音量です。値は 0～127です。<br>符号を付けると現在値からの相対指定になります。| "V(120) cde V(-30) fga"<br>→ 音量120でドレミです、音量90でファソラです|
|Pan([パン値])<br>別名 Panpot| パン(パンポット)です。<br>値は 0(左端)～127(右端)で、中央は64です。<br>符号を付けると現在値からの相対指定になります。| "Pan(10) cde Pan(+50) fga"<br>→ パン10でドレミ、パン60でファソラです|
|PitchBend([ベンド値])| ピッチベンドです。<br>値は -8192(2音下)～8191(2音上)で、中央は0です。| "PitchBend(-4096) cde Pan(0) cde"<br>→ 半音下げたドレミと通常のドレミです|
|CC([コントロール番号],[値])<br>別名 ContorlChange| コントロールチェンジです。<br>第1引数がコントロール番号、第1引数が値です| "CC(0,10)CC(32,130)@2" バンクセレクトしたプログラムチェンジです。|
|CreateSequence(<br>&emsp;name:[シーケンス名],<br>&emsp;mml:[MML],<br>)|シーケンス(サブシーケンス)を定義します。<br>楽曲(MML)を部品として定義し、以降のMMLの中で呼び出す(張り付ける)ことができます。| // ドラムパターンを定義します<br/>CreateSequence(name:drum, mml:"<br/>&emsp;CreatePort(name:kick, channel:10) l8 o1 c^^c ^c^^<br/>&emsp;CreatePort(name:snare, channel:10) l8 o1 ^^d^ ^^d^<br/>")|
|Seq([シーケンス名],length:[長さ(省略可)])<br>別名 Sequence|定義済のシーケンス(サブシーケンス)を呼び出します。| // 定義したドラムパターンを3回繰り返します。<br>// 3周目のシ－ケンスは2分音符分のみ採用します<br/>Seq(drum) Seq(drum) Seq(drum,length:2)|

## 文字列

文字列を指定する箇所では、以下の書式が使えます。

|  表記  |  説明  |例|
| ---- | ---- | ---- |
| ○○○ | 英数字のみの場合でこの指定が可能です。| abcdefg  |
| "○○○" | " から " までが文字列です。空白や記号を以外を使う場合にも使えます。　| "drum part"
| R"\*\*(○○○)\*\*" | 空白や記号や " を使う場合にも使えます。<br>シーケンスの中にシーケンスを定義するような場合は、** を一意の文字列にすることで文字列定義の中に文字列定義があるようなケースに対応できます　| R"(drum)"<br><br> R"ch1( mml:R"(drum)" )ch1"


## コメント

|  表記  |  説明  |例|
| ---- | ---- | ---- |
| // ○○○| １行コメントです。// 以降、改行までがコメントです。| // ここがコメントです |
| /* ○○○ */ | 範囲コメントです。<br>/* から */ までがコメントです。複数行に跨ぐコメントも可です。| /* ここが<br>コメントです */|

# Licence

[LICENSE](/LICENSE)

